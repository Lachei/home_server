<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <style>
    html * {
      font-family: Arial, Helvetica, sans-serif;
      font-size: min(7vw, 1cm);
    }

    h1 {
      text-align: center;
      font-size: 200%;
    }

    /* Full-width input fields */
    input[type=text],
    input[type=password] {
      width: 100%;
      padding: 12px 20px;
      margin: 8px 0;
      display: inline-block;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }

    button {
      background-color: #04AA6D;
      color: white;
      padding: 14px 20px;
      margin: 5%;
      border: none;
      cursor: pointer;
      width: 90%;
    }

    button:hover {
      opacity: 0.8;
    }

    .container {
      padding: 16p;
      margin: auto;
      max-width: 500px;
    }
    </style>
  </head>

  <body>
    <h1>Wilkommen auf Lacheis minifuziserver</h1>
    <div class="container">
      <label for="username">Benutzername</label><input id="username" type="text" onkeydown="if (event.key === 'Enter') login();">
      <label for="password">Passwort</label><input id="password" type="password" onkeydown="if (event.key === 'Enter') login();">
      <button onclick="login();">Anmelden</button>
      <div id="error" style="display:none;color: red;">Benutzername oder passwort falsch</div>
    </div>
  </body>
  <script>
  async function login() {
    let u = document.getElementById("username").value;
    let p = document.getElementById("password").value;
    const encoder = new TextEncoder();
    let hash = await window.crypto.subtle.digest("SHA-256", encoder.encode(`${u}:user@minifuziserver.duckdns.org:${p}`));
    hash = new Uint8Array(hash).toHex();
    let v = await fetch("login", {headers:{login:`${u}:${hash}`}});
    if (v.ok) {
      window.location.href = window.location.origin + '/overview';
    } else {
      document.getElementById("error").style.display = "block";
      setTimeout(()=>{document.getElementById("error").style.display = "none";}, 5000);
    }
  }
  </script>
</html>
